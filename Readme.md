# Spring Boot and Grpc


[Tutorial](https://www.youtube.com/playlist?list=PLVz2XdJiJQxw0f6wXQCdWKabLdqSzGA0X)

## Introduction

While rest only supports Request-Response *UNARY* communication patterns, grpc supports many communication patterns:

 - UNARY
 - SERVER STREAMING
 - CLIENT STREAMING
 - BIDIRECTIONAL STREAMING

![img.png](images/grpc_communication_patterns.png)

## Server

### Unary

In case of unary is more or less like a REST server, except you have the proto folder and you have to run

    ./mvnw clean install 

To generate the `target/generate-sources/protobuf` source folder. Then it behaves like a *contract-first* approach.

You create a class named for example `StockTradingServiceImpl` which extends the class generated by protobuf `StockTradingServiceGrpc.StockTradingServiceImplBase` and 
override/implement the methods you want to override

## Client

### Unary

Spring boot right now does not have a client for grpc so we have to remove these two dependencies

    <dependency>
        <groupId>org.springframework.grpc</groupId>
        <artifactId>spring-grpc-spring-boot-starter</artifactId>
    </dependency>

    <dependency>
        <groupId>org.springframework.grpc</groupId>
        <artifactId>spring-grpc-test</artifactId>
        <scope>test</scope>
    </dependency>

And add a grpc client dependency

        <dependency>
			<groupId>net.devh</groupId>
			<artifactId>grpc-client-spring-boot-starter</artifactId>
			<version>3.1.0.RELEASE</version>
		</dependency>

Then in `StockTradingServiceGrpc` you can find a lot of method you can use to *stub* your requests. Some of that are used for 
unary operations and some others for streaming operations. 

*When you implement the java class, since it's not a grpc server application you muss not use the @GrpcService annotation*

    @Service
    public class StockClientService {
    }

When you define a stub in the client you have to give it a name, in our case `stockService`

    @GrpcClient("stockService")
    private StockTradingServiceGrpc.StockTradingServiceBlockingStub serviceBlockingStub;

Then in the `application.yml` you define the following structure to be sure that the client is connected to the right service

    grpc:
        client:
            stockService:
                address: "static://localhost:9090"
                negotiation-type: PLAINTEXT

As you can see the `stockService` named is defined here to configure the address and the negotiation-type